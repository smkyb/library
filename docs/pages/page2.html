<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>smkyb's library</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.1/github-markdown.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
<style>
    html { background: repeating-linear-gradient(-45deg, rgb(245, 245, 245), 40px, rgb(255, 255, 255) 40px, rgb(255, 255, 255) 70px); }
    body { margin: 60px; margin-top: 60px; min-height: 100vh; font-family:'Noto Sans JP', Arial, sans-serif; font-size:large; }
    .markdown-body { box-sizing: border-box; max-width: 900px; margin: 0 auto; background: #ffffff56; backdrop-filter: blur(3px); color: black; padding: 40px; }
    .markdown-body pre { padding: 16px; overflow: auto; }
    .button_sq button       { display: flex; font-size: 22px; flex-direction: column; gap: 20px; margin-bottom: 10px; padding: 10px; padding-left: 30px; padding-right: 30px; background-color: rgb(89, 158, 157); color: white; border: none; cursor: pointer; text-align: center; transition: 0.5s; }
    .button_sq button:hover { display: flex; font-size: 22px; flex-direction: column; gap: 20px; margin-bottom: 10px; padding: 10px; padding-left: 90px; padding-right: 90px; background-color: rgb(0, 67, 67);    color: white; border: none; cursor: pointer; text-align: center; transition: 0.5s; }
    #button_copy { display: flex; font-size: 14px; }
    #button_copy_oneline { display: flex; font-size: 14px; }
    #status_bar { display: flex; justify-content: center; position: fixed; height: 70px; width:100%; top: 0px; left: 0px; background-color: rgba(255, 255, 255, 0.258);  backdrop-filter: blur(20px); font-family: sans-serif; font-size: 20px; font-weight: bolder; align-content: center; color: white; z-index: 998244353; }
    #status_bar a { margin: 20px; text-decoration: none; color: rgb(63, 97, 144); }
</style>
</head>
<body>
<div id="status_bar">
    <a href="/library/index.html">home</a>
    <a href="/library/about">about</a>
</div>
<article id="md_content" class="markdown-body">
# Coordinate Compression

与えられた複数の `std::vector` に含まれる値の範囲を圧縮（座圧）します。
これにより、元の値の大小関係を保ったまま、より小さい値の集合で表現することができます。

## 関数
```cpp
template&lt;typename T, typename... Args&gt;
vector&lt;T&gt; compression(vector&lt;T&gt;&amp; v, Args&amp;... args)
```

・`v`: 圧縮したい `std::vector` です。このベクターの値は、関数内で変更されます。
・`args...`: 圧縮したい他の `std::vector` を可変長引数で指定します。これらのベクターの値も、関数内で変更されます。

### 制約
・圧縮対象の `std::vector` は、同じ型 `T` である必要があります。
・`std::vector` の要素は、比較可能である必要があります (`operator&lt;` が定義されていること)。

### 返り値
圧縮後のユニークな値のソートされた `std::vector` を返します。これは、各元の `std::vector` の要素を、この返り値のベクターにおけるインデックスに置き換えた結果となります。

### 計算量
・`N`: 全ての `std::vector` を合わせた要素数の総和とします。
・`M`: 全ての `std::vector` に含まれるユニークな値の総数とします。

・マージ処理: O(N)
・ソート処理: O(M log M)
・ユニーク化処理: O(M)
・適用処理: O(N log M)

総合して、**O(N + M log M)** です。

## 使用例

```cpp
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;algorithm&gt; // for sort, unique, lower_bound

// compression 関数の定義 (ソースコードから抜粋)
void _compression_merge(...){}
template&lt;typename T, typename... Args&gt;
void _compression_merge(vector&lt;T&gt;&amp; C, vector&lt;T&gt;&amp; v, Args&amp;... args){
    for(auto&amp; i : v) C.push_back(i);
    _compression_merge(C, args...);
}
void _compression_apply(...){}
template&lt;typename T, typename... Args&gt;
void _compression_apply(vector&lt;T&gt;&amp; C, vector&lt;T&gt;&amp; v, Args&amp;... args){
    for(auto&amp; i : v) i = lower_bound(C.begin(), C.end(), i) - C.begin();
    _compression_apply(C, args...);
}
template&lt;typename T, typename... Args&gt;
vector&lt;T&gt; compression(vector&lt;T&gt;&amp; v, Args&amp;... args){
    vector&lt;T&gt; C;
    _compression_merge(C, v, args...);
    sort(C.begin(), C.end());
    C.erase(unique(C.begin(), C.end()), C.end());
    _compression_apply(C, v, args...);
    return C;
}

int main() {
    vector&lt;int&gt; a = {5, 2, 8, 2, 5, 1};
    vector&lt;int&gt; b = {10, 8, 3, 10};

    vector&lt;int&gt; unique_sorted_values = compression(a, b);

    // 圧縮後の a
    // a は {2, 1, 3, 1, 2, 0} に変更される
    for (int val : a) {
        std::cout &lt;&lt; val &lt;&lt; &quot; &quot;;
    }
    std::cout &lt;&lt; std::endl; // 出力: 2 1 3 1 2 0

    // 圧縮後の b
    // b は {4, 3, 0, 4} に変更される
    for (int val : b) {
        std::cout &lt;&lt; val &lt;&lt; &quot; &quot;;
    }
    std::cout &lt;&lt; std::endl; // 出力: 4 3 0 4

    // 圧縮後のユニークな値
    // unique_sorted_values は {1, 2, 3, 5, 8, 10} になる
    for (int val : unique_sorted_values) {
        std::cout &lt;&lt; val &lt;&lt; &quot; &quot;;
    }
    std::cout &lt;&lt; std::endl; // 出力: 1 2 3 5 8 10

    return 0;
}
```</article>

<button id="button_copy" data-copy="void _compression_merge(...){}
template&lt;typename T, typename... Args&gt;
void _compression_merge(vector&lt;T&gt;&amp; C, vector&lt;T&gt;&amp; v, Args&amp;... args){
    for(auto&amp; i : v) C.push_back(i);
    _compression_merge(C, args...);
}
void _compression_apply(...){}
template&lt;typename T, typename... Args&gt;
void _compression_apply(vector&lt;T&gt;&amp; C, vector&lt;T&gt;&amp; v, Args&amp;... args){
    for(auto&amp; i : v) i = lower_bound(C.begin(), C.end(), i) - C.begin();
    _compression_apply(C, args...);
}
template&lt;typename T, typename... Args&gt;
vector&lt;T&gt; compression(vector&lt;T&gt;&amp; v, Args&amp;... args){
    vector&lt;T&gt; C;
    _compression_merge(C, v, args...);
    sort(C.begin(), C.end());
    C.erase(unique(C.begin(), C.end()), C.end());
    _compression_apply(C, v, args...);
    return C;
}">copy</button>
<button id="button_copy_oneline" data-copy="void _compression_merge(...){} template&lt;typename T, typename... Args&gt; void _compression_merge(vector&lt;T&gt;&amp; C, vector&lt;T&gt;&amp; v, Args&amp;... args){ for(auto&amp; i : v) C.push_back(i); _compression_merge(C, args...); } void _compression_apply(...){} template&lt;typename T, typename... Args&gt; void _compression_apply(vector&lt;T&gt;&amp; C, vector&lt;T&gt;&amp; v, Args&amp;... args){ for(auto&amp; i : v) i = lower_bound(C.begin(), C.end(), i) - C.begin(); _compression_apply(C, args...); } template&lt;typename T, typename... Args&gt; vector&lt;T&gt; compression(vector&lt;T&gt;&amp; v, Args&amp;... args){ vector&lt;T&gt; C; _compression_merge(C, v, args...); sort(C.begin(), C.end()); C.erase(unique(C.begin(), C.end()), C.end()); _compression_apply(C, v, args...); return C; }">copy_oneline</button>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
    marked.setOptions({ gfm: true, breaks: true, headerIds: true, mangle: false, highlight: (code, lang) => { if (lang && hljs.getLanguage(lang)) { return hljs.highlight(code, { language: lang }).value; } return hljs.highlightAuto(code).value; } });
    const mdContent = document.getElementById("md_content");
    if(mdContent) mdContent.innerHTML = marked.parse(mdContent.textContent);
    
    const copyButton = document.getElementById("button_copy")
    if(copyButton){
        copyButton.addEventListener("click", () => {
            const text = copyButton.dataset.copy;
            navigator.clipboard.writeText(text);
        })
    }
    const copyButtonOneline = document.getElementById("button_copy_oneline")
    if(copyButtonOneline){
        copyButtonOneline.addEventListener("click", () => {
            const text = copyButtonOneline.dataset.copy;
            navigator.clipboard.writeText(text);
        })
    }
</script>
</body>
</html>